generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model session {
  sid    String   @id @db.VarChar
  sess   Json     @db.Json
  expire DateTime @db.Timestamp(6)

  @@index([expire], map: "IDX_session_expire")
}

model users {
  id           Int            @id @default(autoincrement())
  username     String         @unique @db.VarChar(50)
  password     String         @db.VarChar(255)
  created_at   DateTime?      @default(now()) @db.Timestamp(6)
  email        String?        @unique @db.VarChar(255)
  createdRooms rooms[]        @relation("CreatedRooms")
  joinedRooms  usersInRooms[]

  invitesSent     invites[] @relation("InviterRelation")
  invitesReceived invites[] @relation("InviteeRelation")
}

model rooms {
  id           Int            @id @default(autoincrement())
  name         String
  createdBy    users          @relation("CreatedRooms", fields: [userId], references: [id])
  userId       Int
  created_at   DateTime       @default(now())
  updated_at   DateTime       @updatedAt
  usersInRooms usersInRooms[]
  invites      invites[]
  competitions competitions[]

  @@unique([name, userId])
}

model usersInRooms {
  user     users    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId   Int
  room     rooms    @relation(fields: [roomId], references: [id], onDelete: Cascade)
  roomId   Int
  joinedAt DateTime @default(now())

  @@id([userId, roomId])
}

model invites {
  inviter   users    @relation("InviterRelation", fields: [inviterId], references: [id], onDelete: Cascade)
  inviterId Int
  invitee   users    @relation("InviteeRelation", fields: [inviteeId], references: [id], onDelete: Cascade)
  inviteeId Int
  room      rooms    @relation(fields: [roomId], references: [id], onDelete: Cascade)
  roomId    Int
  sentAt    DateTime @default(now())

  @@id([inviterId, inviteeId, roomId])
}

model competitions {
  id           Int       @id @default(autoincrement())
  room         rooms     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  roomId       Int
  name         String
  startTime    DateTime
  endTime      DateTime?
  // https://stackoverflow.com/questions/313417/whats-the-best-way-to-store-the-days-of-the-week-an-event-takes-place-on-in-a-r
  daysOfWeek   Int?
  repeatsEvery Int
  frequency    Frequency
}

enum Frequency {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}
